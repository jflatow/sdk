<html>
  <head>
    <title>New Stuff</title>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <style>
      * {
        user-select: none;
      }

      #paper {
        width: 100%;
        height: 100%;
      }

      .pressed {
        color: green;
      }
    </style>
  </head>
  <body>
    <div id="paper"></div>
    <script type="module">
      import { assert } from './assert.js';
      import { Sky, Events, Gestures, Transforms, Components } from '../sdk.js';
      const { Amp, Loop } = Transforms;
      const { Button, Text, Wagon } = Components;

      const paper = Sky.$('#paper');
      const text1 = new Text(paper.div());
      const text2 = new Text(paper.div(), null);
      const text3 = new Text(paper.div(), null, { text: "Hello there" });
      const text4 = Text.quick(paper.div(), { text: "Hello there" });

      const button1 = new Button(paper.div(), null, {
        app: { do_Button: () => console.log('do_Button', button1) }
      });
      const button2 = new Button(paper.div(), {
        grab: (e) => console.log('grab', button2, e),
        move: function ([dp]) {
          button2.elem.txt(dp);
        },
        send: (m) => console.log('send', m),
        free: (e) => console.log('free', button2, e),
      });

      let grabbed, freed;
      Gestures.press(text1.elem, new Wagon(text2.elem, {
        grab: (e) => {
          grabbed = true;
          console.log('grab', e)
        },
        free: (e) => {
          freed = true;
          console.log('free', e)
        },
      }));
      Gestures.scroll(paper, new Wagon(text3.elem));
      Gestures.swipe(paper, new Wagon(text4.elem));
      Gestures.tap(paper, new Wagon(paper));

      // XXX how to start building out browser tests?
      //  tests given component classes, will leverage from progs?
      //  compose sequences of actions/messages
      text1.elem.dispatch(new PointerEvent(Events.pointerdown, { pressure: 1 }));
      setTimeout(() => {
        text1.elem.dispatch(new PointerEvent(Events.pointerup, { bubbles: true }));
      }, 3000);

      setTimeout(() => {
        assert(grabbed, 'not grabbed');
        assert(freed, 'not freed');
      }, 3100);

      setTimeout(() => {
        button2.elem.dispatch(new PointerEvent(Events.pointerdown));
      }, 3200);
      setTimeout(() => {
        button2.elem.dispatch(new PointerEvent(Events.pointerup, { bubbles: true }));
        button2.setOpts({});
      }, 5000);
    </script>
  </body>
</html>
